name: Build WinlatorXRBridge

on:
  push:
    branches: [ main ]
  pull_request:
    branches: [ main ]

jobs:
  build:
    runs-on: windows-latest

    steps:
    - name: Checkout repository
      uses: actions/checkout@v3

    - name: Setup .NET
      uses: actions/setup-dotnet@v3
      with:
        dotnet-version: '7.0.x'

    - name: Ensure lib folder exists
      run: |
        if (-Not (Test-Path lib)) {
          Write-Host "lib folder missing, creating..."
          New-Item -ItemType Directory -Path lib
        } else {
          Write-Host "lib folder exists, skipping creation"
        }

    # Skip HarmonyLib download: we already have it in lib/
    - name: Verify HarmonyLib.dll
      run: |
        if (-Not (Test-Path lib\HarmonyLib.dll)) {
          Write-Error "HarmonyLib.dll is missing in lib/. Please add it to the repo."
        } else {
          Write-Host "HarmonyLib.dll found, using committed DLL"
        }

    - name: Build WinlatorXRBridge DLL
      run: |
        dotnet build src/WinlatorXRBridge.csproj -c Release
      shell: powershell
